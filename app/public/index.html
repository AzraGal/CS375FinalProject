<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Lively</title>
    
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plaster&display=swap" rel="stylesheet">
    <!-- Select2 -->
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- date range-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
</head>
<body class='bodyStyle'>
    <div class='header'>
        <div>
            <p class="headerTitle">LIVELY</p>
        </div>
        <div>
            <div class="xcontainer">
                <div id="login" class='spotifybtn'>
                    <a href="/login" class="">Log in with Spotify</a>
                </div>
                <!-- <button id="loginSpotify" >Log In to Spotify</button> -->
                <div id="loggedin" class="loggedin">
                    <div id="user-profile">
                    </div>
                    <div id="oauth">
                    </div>
                    <button class="btn btn-default" id="obtain-new-token">Refresh Token</button>
                </div>
            </div>
            <script id="user-profile-template" type="text/x-handlebars-template">
                <div>Logged in as {{display_name}}</div>
            </script>

        </div>
    </div>

    <h3>Lively! Everything you need to see your favorite artists in real life.</h3>
        <div class='tabs'>
            <div class="tab">
                <div id='customSearch' class="tablinks">
                    Custom Search
                </div>
                <div id='spotifySearch' class="tablinks">
                    Use My Spotify
                </div>
            </div>
    
              <!-- Tab content https://www.w3schools.com/howto/howto_js_tabs.asp-->
              <div id="customContent" class="tabcontent">
                <div class="filterRow">
                    <div>
                        <label for="artist">Artist</label>
                        <input id="artist" type="text" name="artist">
                        <div id="selectedArtists"></div>
                    </div>
                    <div class="genreInput">
                        <label for="genre">Genre</label>
                        <select class="js-example-basic-multiple genreSelect" name="genres[]" multiple="multiple" id="genre">
                        </select>
                    </div>
                    <div>
                        <label for="location">Location (City, State)</label>
                        <input id="location" type="text" name="location">
                    </div>
                    <div>
                        <label for="daterange">Dates</label>
                        <input type="text" name="daterange" value="01/01/2023 - 01/15/2023" />
                    </div>
                    <div>
                        <label class='nolabel'>Search</label>
                        <button id="submitSearchButton" class="submitSearchButton">Search</button>
                    </div>
                </div>
              </div>
              
              <div id="spotifyContent" class="tabcontent">
                <div class="spotifyContent">
                    <label>See events with your top artists and generes from Spotify </label>
                    <button id='buttontopartist' class="submitSearchButton">Fetch Events</button>
                </div>
              </div>

        </div>



        <!-- <script id="oauth-template" type="text/x-handlebars-template">
      <h2>oAuth info</h2>
      <dl class="dl-horizontal">
        <dt>Access token</dt><dd class="text-overflow">{{access_token}}</dd>
        <dt>Refresh token</dt><dd class="text-overflow">{{refresh_token}}</dd>
      </dl>
    </script> -->
        <!-- this button will get you top arists and genres -->
        
        <button id='buttonTicketMasterGenres'>Get TicketMaster Genres</button>
        <button id='buttonTicketMasterEvents'>Get TicketMaster Events</button>
        <br>
        <br>
        <div id="suggestedArtists" style="display: none;">Suggested Artists:</div>
        <div class="mapConcerts">
          <div class="map" id="map"> Map </div>
          <div class="map" id="legend"><center><h4>Legend</h4></center></div>
          <div class="concerts">
              <div class="concertTableHeader">
                  <p class="resultHeader">Concerts</p>
                  <button id='allConcerts'>Show all concerts on Map</button>
              </div>
            <div class="concertTable">
                <table id="eventsTable" class="resTable eventsTable">
                    <thead>
                        <tr>
                            <th>Event</th>
                            <th>Date</th>
                            <th>Venue</th>
                            <th>Price</th>
                            <!-- <th>Link to Purchase Ticket</th> -->
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody">
                    </tbody>
                  </table>
            </div>
          </div>
        </div>
        <div id="hotelLocations"></div>
        <div class="results">
          <!-- Table Code -->
          <div>
              <p class="resultHeader" id="hotelResults">Hotels</p>
       
                <table class="resTable">
                    <thead>
                        <tr>
                            <th>Hotel Name</th>
                            <th>Address</th>
                            <th>Price Per Night</th>
                        </tr>
                    </thead>
                    <tbody id="hotelBody">
                    <tr>
                        <td>Hotel Name</td>
                        <td>Address</td>
                        <td>Price Per Night</td>
                    </tr>
                    </tbody>
                </table>

          </div>
      </div>
        <div id="hotelLocations"></div>
        <div id="hotelResults">
            <table>
                <thead id="hotelHead"></thead>
                <tbody id="hotelBody"></tbody>
            </table>
        </div>
        <div id="cookieConsentContainer">
            <h3>We Use Cookies!</h3>
            <p>Lively uses cookies to enhance your browser experience. By accepting, you agree to let us save your search results until your cookie expires.</p>
            <button id="acceptCookieButton" class="cookieButton">Accept</button>
            <button id="declineCookieButton" class="cookieButton">Decline</button>
        </div>
        <script type="module" src="cookies.js"></script>
        <script type="module" src="ticketmaster.js"></script>
        <script type="module" src="spotify.js"></script>     

        <script type="module" src="artistSearch.js"></script>
        <script type="module" src="ticketmaster.js"></script>
        
        <script type="module" src="index.js"></script>
        
        <script type="module" src="search.js"></script>

        <script type="module" src="maps.js"></script>
        <script type="module" src="hotels.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZ5ulv-oR0cVSQkN_x6gBjIWw-itZzOC0&v=beta&libraries=marker&callback=initMap" defer></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
       <script>
            (function () {
                /**
                 * Obtains parameters from the hash of the URL
                 * @return Object
                 */
                function getHashParams() {
                    var hashParams = {};
                    var e, r = /([^&;=]+)=?([^&;]*)/g,
                        q = window.location.hash.substring(1);
                    while (e = r.exec(q)) {
                        hashParams[e[1]] = decodeURIComponent(e[2]);
                    }
                    return hashParams;
                }

                var userProfileSource = document.getElementById('user-profile-template').innerHTML,
                    userProfileTemplate = Handlebars.compile(userProfileSource),
                    userProfilePlaceholder = document.getElementById('user-profile');

                // var
                //     oauthSource = document.getElementById('oauth-template').innerHTML,
                //     oauthTemplate = Handlebars.compile(oauthSource),
                //     oauthPlaceholder = document.getElementById('oauth');

                var params = getHashParams();

                var access_token = params.access_token,
                    refresh_token = params.refresh_token,
                    error = params.error;

                if (error) {
                    alert('There was an error during the authentication');
                } else {
                    if (access_token) {
                        // render oauth info
                        // oauthPlaceholder.innerHTML = oauthTemplate({
                        //   access_token: access_token,
                        //   refresh_token: refresh_token
                        // });

                        $.ajax({
                            url: 'https://api.spotify.com/v1/me',
                            headers: {
                                'Authorization': 'Bearer ' + access_token
                            },
                            success: function (response) {
                                // console.log("succ", userProfileTemplate(response))
                                userProfilePlaceholder.innerHTML = userProfileTemplate(response);

                                // $('#login').hide();
                                $('#loggedin').show();
                            }
                        });
                    } else {
                        // render initial screen
                        $('#login').show();
                        // $('#loggedin').hide();
                    }

                }
            })();
        </script>
</body>
</html>